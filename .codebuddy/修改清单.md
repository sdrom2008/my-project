# ä»£ç ä¿®æ”¹æ¸…å•

## æ¦‚è¿°
æœ¬æ¸…å•è®°å½•äº† AI åŠ©æ‰‹åœ¨æœ¬æ¬¡å¯¹è¯ä¸­æ‰€æœ‰çš„ä»£ç ä¿®æ”¹å’Œåˆ é™¤æ“ä½œã€‚

---

## åç«¯ä¿®æ”¹ (.NET/C#)

### 1. **Synerixis.Domain/Entities/SellerProduct.cs** âœ… å·²ä¿®æ”¹
**ä¿®æ”¹å†…å®¹**ï¼šä¿®å¤å¤–é”®å±æ€§ä¸ºéç©º
```csharp
// ä¿®æ”¹å‰
public Guid? SellerId { get; set; }
public Guid? ProductId { get; set; }

// ä¿®æ”¹å
public Guid SellerId { get; set; }
public Guid ProductId { get; set; }
```
**åŸå› **ï¼šæ•°æ®åº“è¿ç§»è¦æ±‚è¿™ä¸¤ä¸ªå­—æ®µä¸º NOT NULLï¼Œå±æ€§å®šä¹‰åº”ä¸æ•°æ®åº“ä¸€è‡´

---

### 2. **Synerixis.Infrastructure/Data/AppDbContext.cs** âœ… å·²ä¿®æ”¹
**ä¿®æ”¹å†…å®¹**ï¼šæ·»åŠ å¤–é”®çº¦æŸçš„ `.IsRequired()` é…ç½®
```csharp
// ä¿®æ”¹å‰
entity.HasOne(p => p.Seller)
      .WithMany(s => s.SellerProducts)
      .HasForeignKey(p => p.SellerId)
      .OnDelete(DeleteBehavior.Cascade);

entity.HasOne(p => p.Product)
      .WithMany(prod => prod.SellerProducts)
      .HasForeignKey(p => p.ProductId)
      .OnDelete(DeleteBehavior.NoAction);

// ä¿®æ”¹å
entity.HasOne(p => p.Seller)
      .WithMany(s => s.SellerProducts)
      .HasForeignKey(p => p.SellerId)
      .OnDelete(DeleteBehavior.Cascade)
      .IsRequired();

entity.HasOne(p => p.Product)
      .WithMany(prod => prod.SellerProducts)
      .HasForeignKey(p => p.ProductId)
      .OnDelete(DeleteBehavior.NoAction)
      .IsRequired();
```
**åŸå› **ï¼šç¡®ä¿ EF Core é…ç½®ä¸æ•°æ®åº“çº¦æŸä¸€è‡´ï¼Œè§£å†³ 500 é”™è¯¯é—®é¢˜

---

### 3. **Synerixis.Application/DTOs/ProductImportDto.cs** âœ… å·²ä¿®æ”¹
**ä¿®æ”¹å†…å®¹**ï¼š
- å°† `Price` å­—æ®µä» `decimal?` æ”¹ä¸º `string?`
- æ‰€æœ‰å­—æ®µæ”¹ä¸ºå¯ç©º (`?`)
- æ·»åŠ  `[JsonPropertyName]` å±æ€§å¤„ç† camelCase

```csharp
// å…³é”®ä¿®æ”¹
[JsonPropertyName("price")]
public string? Price { get; set; }  // ä»å‰ç«¯æ¥æ”¶ä¸º stringï¼Œå†…éƒ¨è½¬æ¢
```
**åŸå› **ï¼šå‰ç«¯å‘é€çš„ price æ˜¯å­—ç¬¦ä¸²æ ¼å¼ï¼Œéœ€è¦åœ¨åç«¯è½¬æ¢ä¸º decimal

---

### 4. **Synerixis.Infrastructure/Services/ProductService.cs** âœ… å·²ä¿®æ”¹
**ä¿®æ”¹å†…å®¹**ï¼šæ·»åŠ å­—ç¬¦ä¸²è½¬ decimal çš„é€»è¾‘
```csharp
// æ–°å¢çš„è½¬æ¢é€»è¾‘
decimal? price = null;
if (!string.IsNullOrWhiteSpace(dto.Price) && decimal.TryParse(dto.Price, out var parsedPrice))
{
    price = parsedPrice;
}

// ç„¶ååœ¨ä½¿ç”¨ price æ—¶ç”¨è½¬æ¢åçš„å€¼
product.Price = price ?? product.Price;
sellerProduct.CustomPrice = price;
```
**åŸå› **ï¼šå®‰å…¨åœ°å¤„ç†å‰ç«¯å­—ç¬¦ä¸²è½¬æ•°å­—çš„è½¬æ¢

---

### 5. **Synerixis.Api/Controllers/PayController.cs** âŒ æ›¾åˆ é™¤ï¼Œç°å·²æ¢å¤
**æ“ä½œ**ï¼š
1. è¯¯åˆ äº†æ•´ä¸ªæ–‡ä»¶
2. ä» git æ¢å¤äº†åŸå§‹å†…å®¹ï¼š`git checkout HEAD -- Synerixis.Api/Controllers/PayController.cs`

**å¾®ä¿¡æ”¯ä»˜ç«¯ç‚¹**ï¼š
- `POST /api/pay/create-order` - åˆ›å»ºè®¢å•
- `POST /api/pay/query-order/{outTradeNo}` - æŸ¥è¯¢è®¢å•
- `POST /api/pay/callback` - æ”¯ä»˜å›è°ƒ

**åŸå› **ï¼šè¯¥æ–‡ä»¶æ²¡æœ‰ç¼–è¯‘é”™è¯¯ï¼Œä¸åº”è¯¥è¢«åˆ é™¤ã€‚è¯¯åˆ æ˜¯åŠ©æ‰‹çš„é”™è¯¯ã€‚

---

### 6. **Synerixis.Api/Program.cs** âœ… å…¶ä»–ä¿®æ”¹ï¼ˆæœªæ˜¾ç¤ºå·®å¼‚ï¼‰
**è¯´æ˜**ï¼šå¯èƒ½æœ‰å…¶ä»–æ³¨å†Œæˆ–é…ç½®ä¿®æ”¹ï¼Œéœ€è¦æŸ¥çœ‹ `git diff Synerixis.Api/Program.cs` æ¥ç¡®è®¤

---

### 7. **Synerixis.Infrastructure/Migrations/** ğŸ”„ è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶
**è¯´æ˜**ï¼šè¿ç§»æ–‡ä»¶è¢« EF Core è‡ªåŠ¨ä¿®æ”¹ï¼Œå¯èƒ½æ¶‰åŠï¼š
- `AppDbContextModelSnapshot.cs`
- `20260202173721_InitialCreateWithLowerCaseTables.cs`
- `20260202173721_InitialCreateWithLowerCaseTables.Designer.cs`

---

## å‰ç«¯ä¿®æ”¹ (Vue/TypeScript)

### 8. **frontend/vite.config.ts** âœ… å·²ä¿®æ”¹
**ä¿®æ”¹å†…å®¹**ï¼šæ·»åŠ æœåŠ¡å™¨ç»‘å®šé…ç½®
```typescript
// ä¿®æ”¹å‰
export default defineConfig({
  plugins: [uni()],
});

// ä¿®æ”¹å
export default defineConfig({
  plugins: [uni()],
  server: {
    host: "0.0.0.0",
    port: 5173,
  },
});
```
**åŸå› **ï¼šå…è®¸å‰ç«¯æœåŠ¡å™¨ç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£ (0.0.0.0)

---

### 9. **frontend/src/pages/pay/subscribe.vue** âš ï¸ å¯èƒ½æœ‰ä¿®æ”¹
**è¯´æ˜**ï¼šæ­¤æ–‡ä»¶åœ¨ä¿®æ”¹åˆ—è¡¨ä¸­ï¼Œéœ€è¦æŸ¥çœ‹å…·ä½“å·®å¼‚

---

### 10. **frontend/src/pages/products/import.vue** âœ… å·²ä¿®æ”¹
**è¯´æ˜**ï¼šå¯èƒ½æ¶‰åŠé”™è¯¯å¤„ç†ã€API è°ƒç”¨ç­‰æ”¹è¿›

---

### 11. **frontend/src/pages/products/optimize.vue** âœ… å·²ä¿®æ”¹
**è¯´æ˜**ï¼šå¯èƒ½æœ‰ç•Œé¢æˆ–é€»è¾‘æ”¹åŠ¨

---

### 12. **frontend/src/pages/products/products.vue** âœ… å·²ä¿®æ”¹
**è¯´æ˜**ï¼šå¯èƒ½æ¶‰åŠäº§å“åˆ—è¡¨æ˜¾ç¤ºã€åˆ é™¤åŠŸèƒ½ç­‰

---

### 13. **frontend/src/pages/profile/profile.vue** âœ… å·²ä¿®æ”¹
**è¯´æ˜**ï¼šå¯èƒ½æ›´æ–°äº† API åœ°å€æˆ–å…¶ä»–é…ç½®

---

## æ›¾ç»åˆ›å»ºä½†ååˆ é™¤çš„æ–‡ä»¶

### âŒ å·²åˆ é™¤ï¼šSynerixis.Application/Services/ProductOptimizationService.cs
- **åŸå› **ï¼šä½¿ç”¨äº† C# 11 ä¸æ”¯æŒçš„ä¸‰å¼•å·å­—ç¬¦ä¸²è¯­æ³• (``` """ ```)
- **çŠ¶æ€**ï¼šå·²åˆ é™¤å¹¶æœªæ¢å¤

### âŒ å·²åˆ é™¤ï¼šSynerixis.Api/Controllers/PayController.csï¼ˆå·²æ¢å¤ï¼‰
- **åŸå› **ï¼šè¯¯åˆ ï¼Œæœ¬ä¸åº”è¯¥åˆ é™¤
- **çŠ¶æ€**ï¼šå·²ä» git æ¢å¤

---

## é£é™©è¯„ä¼°

### ğŸ”´ ä¸¥é‡é£é™©ï¼ˆå·²å¤„ç†ï¼‰
1. **PayController è¢«è¯¯åˆ ** â†’ å·²æ¢å¤
2. **SellerProduct å¤–é”®çº¦æŸé”™è¯¯** â†’ å·²ä¿®å¤ï¼ˆå¯¼è‡´ 500 é”™è¯¯ï¼‰
3. **ProductImportDto ç±»å‹ä¸åŒ¹é…** â†’ å·²ä¿®å¤

### ğŸŸ¡ ä¸­ç­‰é£é™©ï¼ˆéœ€éªŒè¯ï¼‰
1. è¿ç§»æ–‡ä»¶ä¿®æ”¹ - éœ€è¿è¡Œ `dotnet ef database update` éªŒè¯
2. å‰ç«¯å¤šä¸ªé¡µé¢ä¿®æ”¹ - éœ€é€ä¸ªæµ‹è¯•

### ğŸŸ¢ ä½é£é™©ï¼ˆé…ç½®å˜æ›´ï¼‰
1. Vite æœåŠ¡å™¨é…ç½® - ä»…å½±å“å¼€å‘ç¯å¢ƒ
2. å…¶ä»–é…ç½®é¡¹ - å½±å“èŒƒå›´è¾ƒå°

---

## å»ºè®®çš„æ¢å¤æ­¥éª¤

```bash
# 1. æŸ¥çœ‹æ‰€æœ‰æœªæäº¤çš„ä¿®æ”¹
git status

# 2. æŸ¥çœ‹å…·ä½“å·®å¼‚ï¼ˆå¦‚éœ€è¦æ¢å¤æŸäº›æ–‡ä»¶ï¼‰
git diff [æ–‡ä»¶è·¯å¾„]

# 3. å¦‚éœ€å®Œå…¨å›æ»šï¼ˆè°¨æ…æ“ä½œï¼ï¼‰
git checkout -- .

# 4. æˆ–åªæ¢å¤ç‰¹å®šæ–‡ä»¶
git checkout -- Synerixis.Application/DTOs/ProductImportDto.cs

# 5. åº”ç”¨æ•°æ®åº“è¿ç§»ï¼ˆå¦‚ä¿®æ”¹äº† EF é…ç½®ï¼‰
dotnet ef database update --project Synerixis.Infrastructure --startup-project Synerixis.Api
```

---

## æ€»ç»“

**ä¿®æ”¹æ–‡ä»¶æ€»æ•°**ï¼š16 ä¸ª  
**åç«¯ä¿®æ”¹**ï¼š7 ä¸ªæ–‡ä»¶  
**å‰ç«¯ä¿®æ”¹**ï¼š9 ä¸ªæ–‡ä»¶  
**å…³é”®é—®é¢˜**ï¼šPayController è¯¯åˆ ï¼ˆå·²æ¢å¤ï¼‰ã€å¤–é”®çº¦æŸä¸ä¸€è‡´ï¼ˆå·²ä¿®å¤ï¼‰

**å»ºè®®**ï¼š
1. âœ… ç›®å‰çŠ¶æ€åº”è¯¥æ˜¯å¯ä»¥è¿è¡Œçš„
2. âš ï¸ å»ºè®®è¿è¡Œä¸€æ¬¡å®Œæ•´çš„æµ‹è¯•
3. ğŸ’¾ ä½¿ç”¨ git ç‰ˆæœ¬æ§åˆ¶çš„å¥½å¤„å¾—åˆ°äº†ä½“ç° - èƒ½å¤Ÿå¿«é€Ÿæ¢å¤åŸæ–‡ä»¶
